---
- name: Download Helm installation script
  ansible.builtin.get_url:
    url: "{{ host_setup_helm_script_url }}"
    dest: /tmp/get_helm.sh
    mode: '0700'
  register: download_result
  failed_when: download_result.failed
  changed_when: download_result.changed

- name: Install Helm using script
  ansible.builtin.command: /tmp/get_helm.sh
  args:
    creates: /usr/local/bin/helm
  register: helm_install_result
  failed_when: helm_install_result.rc != 0
  changed_when: helm_install_result.changed

- name: Remove Helm installation script
  ansible.builtin.file:
    path: /tmp/get_helm.sh
    state: absent

- name: Verify Helm installation
  ansible.builtin.command: helm version
  register: helm_version_result
  failed_when: true
  changed_when: false
